# Schedule

## 12-06

### TODO

1. 2K2000;
2. 看论文，研究背景；
    1. 针对硬件平台的软件系统支持，研究背景不清晰；
    2. 内容单薄，叙述简单，未将研究内容的完成情况讲述清楚；

### Notes

1. 研究背景

    基于龙芯平台的新一代 SoC（System on Chip, SoC）芯片主要是面向于工业网络应用，同时兼顾平板应用及工控领域应用，龙芯新一代SoC芯片采用 LoongArch 精简指令集（Reduced Instruction Set Computer, RISC）架构，是我国自主研发、具有知识产权的芯片，可以满足多场景的产品化应用，主要应用在行业自助终端、核心交换机、数据网关、PLC（Programmable Logic Controller, PLC）、工业核心控制器、工业机器人等。其中，在产品化应用中大部分都与网络息息相关。为了更进一步确保网络的低延迟、确定性和可靠性，引入了TSN（Time-Sensitive Networking，TSN）技术。一方面，TSN 用于保证或提高以太网流量的实时传输性，TSN 的关键特征是在集成及支持TSN的桥接网络上实现低延迟、低抖动、可靠性和确定性，同时，TSN可以用于多种场景，有效解决了协议的兼容性问题。因此，对基于龙芯平台的新一代 SoC 芯片进行 TSN 系统设计与实现成为了刻不容缓的重要问题。

2. 研究内容

    在新一代SoC芯片中添加TSN技术具有一定的先进性和实用性。

    TSN 在以太网中的应用相对于传统以太网具有实时性、可靠性、低延迟性的优势，主要实现了 TSN 相关的几个关键协议，其中包括在IEEE802.1.AS、IEEE802.1.Qav 和 IEEE802.1.Qbv中。首先IEEE802.1.AS 中的PTP（Precise Time Protocol, PTP）确保了数据传输时的高精度时间同步，这是 TSN 技术实现的前提和基础。IEEE802.1.Qav 解决了如何利用优先级信息来确定时间敏感流的流量类别的问题，制定了 CBS（credit-based shaper, CBS）协议，该协议在网络传输队列中除了”BestEffort”队列，主要还增加了两个较高优先级的队列，通过对每个队列分别赋予一个“信用值”，同时可以根据“信用值”来进行传输和调度。 IEEE802.1.Qbv 中制定了 TAS（time awareness shaper, TAS）协议，通过流量类型分类和门控列表，可以在每个时间通道发送特定优先级的数据帧，保证了端对端的传输延迟，同时，还需要一个预留通道，当有数据需要发送时，就立刻调度进入预留通道，若是没有足够的预留通道，那么数据传输就进行“BestEffort”队列调度[5]。因此，在基于龙芯新一代 SoC 芯片上对 TSN 进行设计与实现具有一定的先进性。

    本文选题基于龙芯平台，上一代 SoC 芯片还未支持 TSN 技术，而在龙芯新一代 SoC 芯片中新增 TSN 技术的支持，这是应对未来工业互联网、网络应用场景的必经之路，TSN 与新兴信息产业的融合迫在眉睫，具有一定的实用性。

3. 工作进展

    1. 根据新一代Soc芯⽚⼿册在驱动⾥添加新的TSN相关寄存器的⽀持，如......；
    2. 由于TSN特性的前提是需要多队列⽹卡的⽀持。⽽⽬前Linux Kernel 4.19 中Soc芯⽚上⽹卡是sysbus中断模式，想要由单队列改为多队列⽹卡，不仅需要Soc芯⽚中有关⽹卡硬件⽅⾯的⽀持，还需要驱动⽅⾯的⽀持。⽽驱动⽅⾯，由于之前的sysbus中断只⽀持单队列，因此需要将其重构为改为MSI中断模式，从⽽添加⽹卡多队列，以增加对TSN特性的⽀持；
    3. 由于需要⾼精度的时间同步，因此还需要在驱动中添加linuxptp的⽀持；
    4. 根据802.11Qav和8.2.11Qbv相关协议在 Linux 内核驱动中新增IEEE 802.1AS精准时间同步协议、802.1Qav基于信⽤调度、802.1Qbv中基于时间感知调度和门控列表的⽀持；
